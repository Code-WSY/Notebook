# 笔记：网络通信知识

## MAC地址

### 定义

MAC地址（Media Access Control Address）是一个预先分配给网络接口卡（NIC）的唯一标识符。这个地址通常被固化在硬件设备中。

### 特点

- **唯一性**：全球唯一，由设备制造商分配。
- **不变性**：通常是固定不变的，与设备硬件直接相关。
- **物理地址**：它是网络设备在局域网中的物理地址。

### 作用

- MAC地址主要用于网络中设备间的物理层通信，如在以太网技术中用于帧的传输。

## IP地址

### 定义

IP（Internet Protocol Address）地址是分配给网络上的每个设备的数字标签，用于设备的逻辑定位和网络层通信。

### 公网IP

1. **定义**：公网IP地址（也称为外网IP地址）是在整个互联网上唯一标识一个网络接口的地址。它由互联网服务提供商（ISP）分配给个人、企业或其他组织。
2. **作用**：
   - **全球唯一性**：确保在整个互联网中每个连接的唯一性。
   - **互联网通信**：用于在互联网上定位和识别网络设备，使设备能够访问和被访问。
3. **在通信中的角色**：
   - 当您的设备（如家庭中的电脑）访问互联网时，它使用分配给您网络的公网IP地址与互联网上的其他设备通信。

### 私有IP

1. **定义**：私有IP地址在局域网内部使用，不用于互联网。这些地址在局域网中是唯一的，但在全球范围内可能会重复使用。
2. **作用**：
   - **局域网通信**：用于同一个局域网内部的设备间通信。
   - **地址重用**：允许在不同局域网中重复使用相同的IP地址，减轻了公网IP地址的需求压力。
3. **在通信中的角色**：
   - 在局域网内，设备（如电脑、手机）使用私有IP地址进行相互通信。

### 公网IP和私有IP的联系

- **网络地址转换（NAT）**：路由器通常使用NAT技术将局域网内部的私有IP地址转换为公网IP地址，以便在互联网上通信。当局域网内的设备尝试访问互联网时，路由器会将来自该设备的流量转换为使用公网IP地址，然后发送到互联网。

### 通信示例

- 假设您的家庭网络中有多个设备，每个设备都有一个私有IP地址。
- 当这些设备访问互联网时（例如浏览网页），它们的请求通过路由器发送。
- 路由器使用NAT将这些请求从私有IP地址转换为公网IP地址，并将请求发送到互联网。
- 互联网上的服务器响应这些请求，并将数据发送回您的公网IP地址。
- 路由器接收到这些数据后，再次使用NAT将其路由回到发起请求的私有IP地址。

总结：私有IP地址用于局域网内部设备之间的通信，而公网IP地址用于在互联网上标识和定位设备。通过NAT技术，路由器在私有IP地址和公网IP地址之间建立桥梁，使局域网内部的设备能够访问和与互联网上的设备进行通信。

### 特点

- **动态性**：可以是静态分配的（固定的）或动态分配的（如通过DHCP服务）。
- **逻辑地址**：表示网络中设备的逻辑位置，与物理位置无直接关联。
- **版本**：有IPv4和IPv6两种格式，随着地址空间的扩大，IPv6逐渐流行。

### 作用

IP地址用于在网络层中识别每个网络接口，是互联网上设备通信的关键。

## 子网掩码

### 定义

- **子网掩码**：它是与IP地址配合使用的一个32位数字，用于**标识**网络中的IP地址的哪些位**表示网络**部分，哪些位**表示主机**部分。

### 工作原理

1. **网络与主机部分**：在一个IP地址中，一部分用于标识网络，另一部分用于标识该网络内的特定主机。
2. **掩码应用**：子网掩码通过与IP地址进行逻辑“与”运算来分离这两部分。

### 基本原则

1. **连续的1和0**：子网掩码由连续的1和连续的0组成，其中1代表IP地址的网络部分，0代表主机部分。

2. **从左至右**：1总是从子网掩码的左侧开始，并连续排列，直到达到划分网络和主机所需的位数。



### 标准子网掩码

对应于传统的A、B、C类IP地址。

- A类（如 255.0.0.0）：前8位为网络部分，剩余24位为主机部分。
- B类（如 255.255.0.0）：前16位为网络部分，剩余16位为主机部分。
- C类（如 255.255.255.0）：前24位为网络部分，剩余8位为主机部分。

### 子网划分

- **创建更小网络**：通过改变子网掩码来划分更小的网络。这常用于组织内部，以创建多个子网络，更有效地管理和分配IP地址。
- **子网掩码的变化**：改变子网掩码可以增加网络部分的位数，从而减少用于主机的位数，这样可以创建更多的子网，但每个子网的可分配地址数量会减少。子网掩码对于IP网络的结构和管理至关重要。它们帮助确定网络的大小和布局，对于路由决策也非常重要。

### 示例

- 假设有一个IP地址为192.168.1.10，其子网掩码为255.255.255.0。
  - 网络部分：前三个数字（192.168.1）定义了网络地址。
  - 主机部分：最后一个数字（10）定义了特定主机。
- 如果将C类地址的子网掩码从255.255.255.0更改为255.255.255.192（即 11111111.11111111.11111111.11000000），就将原来的一个网络分割成了四个更小的子网。

### 注意事项

- **无效设置**：子网掩码不能随意设置，必须遵循连续的1后跟连续的0的规则。
- **网络与主机数量**：增加网络部分的位数（即更多的1）会增加可用子网的数量，但减少了每个子网中可用于主机的地址数量。

## DHCP服务简介

- **DHCP（动态主机配置协议）**：它是一个网络协议，用于自动为网络上的设备分配IP地址、子网掩码、默认网关等网络配置信息。
- **自动化配置**：设备（如电脑、手机）加入网络时，DHCP服务器自动为它们提供所需的网络配置。

### DHCP的局域性

- **局限于单个网络**：启用了DHCP服务的路由器将只为直接连接到它的设备分配IP地址和其他网络配置信息。它不会跨越到其他路由器所管理的网络。
- **网络隔离**：不同路由器下的网络通常是隔离的，除非它们之间有特定的网络连接和路由配置，使得它们可以互相通信。

### 多路由器环境中的DHCP

- **独立运作**：如果有三台路由器，每台路由器管理不同的网络段，那么每个网络可以独立地有自己的DHCP服务，互不干扰。
- **服务覆盖范围**：如果其中一个路由器启用了DHCP服务，它只会对连接到该路由器的设备产生影响。

- **其他路由器的通信不受影响**：如果其他两个路由器之间有通信，它们的通信不会直接受到第一个路由器启用DHCP服务的影响，除非这些路由器之间有特定的网络连接和配置，使它们的网络互相“可见”。

### 注意事项

- **避免冲突**：在多路由器网络中，重要的是确保不同路由器（如果它们也启用了DHCP服务）提供的IP地址范围不会发生重叠，以避免IP地址冲突。
- **网络设计**：在复杂的网络环境中，网络设计和配置应该小心规划，以确保网络稳定性和效率。

### DHCP服务冲突

- **发生原因**：当一个网络中存在两个或多个DHCP服务器时，它们可能会尝试为同一设备或不同设备提供不同的配置信息。
- 问题
  - **IP地址冲突**：两个服务器可能分配相同的IP地址给不同的设备，导致地址冲突。
  - **网络配置混乱**：设备可能从不同的DHCP服务器收到不同的配置信息，导致网络设置不一致，进而影响网络通信。

## 交换机

### 定义

交换机是一种网络设备，它的主要作用是在多台**设备之间**转发数据。当设备（如电脑、打印机等）通过网线连接到交换机上时，交换机就能够识别并管理这些设备的网络通信。

### 功能

1. **数据包转发**：每台电脑在网络上都有一个唯一的地址，叫做`IP`地址。当一台设备想要发送数据到另一台设备时，它会将数据封装成数据包，并附上目标设备的`IP`地址。交换机根据数据包的MAC地址（物理地址）决定如何在连接的设备之间转发数据。
2. **网络分段**：交换机能够分割网络流量，减少数据冲突，提高网络效率。

### 工作原理

它工作在数据链路层（OSI模型的第二层），主要负责转发数据帧，**基于MAC地址**决定数据应该从哪个端口转发出去。

### 使用场景

在家庭或办公室内部网络中，用于连接多台设备，使它们能够相互通信。

### 局限性

- **交换机的作用**：交换机主要用于同一局域网内部的设备连接和数据转发。它基于MAC地址在数据链路层工作，不进行跨网络的IP层路由。
- **局域网内通信**：在单个局域网内，交换机可以高效地处理设备间的通信，但它不能直接将数据从一个局域网路由到另一个局域网。

## 路由器

### 定义

- 路由器是连接不同网络的设备，如连接家庭网络和互联网。

### 功能

- **连接不同网络**：
  - 路由器可以将您的家庭或企业网络（私有IP地址网络）连接到互联网（公网IP地址网络）。
  - 它还可以连接两个或多个局域网，使它们能够相互通信。
- **IP地址管理和路由**：
  - 路由器通常负责在内部网络中分配私有IP地址（通常通过DHCP服务）。
  - 它使用网络层的信息（即IP地址）来确定数据包的路由路径。
- **网络地址转换（NAT）**：
  - 在将私有网络连接到互联网时，路由器通过NAT将内部网络上的私有IP地址转换为单个或多个公网IP地址。
  - 这使得多个设备可以共享一个公网IP地址来访问互联网。

### 工作原理

它工作在网络层（OSI模型的第三层），处理IP地址，并决定数据包应该如何从一个网络传输到另一个网络。

### 使用场景

- 连接家庭或企业网络到互联网，并管理内部网络的互联网访问。

- **不同局域网间的通信**：路由器可以连接不同的局域网，或将局域网连接到更大的网络（如互联网）。它工作在网络层（OSI模型的第三层），使用IP地址来路由数据包到正确的目的地。

- **数据包路由**：当一个网络上的设备需要发送数据到另一个局域网上的设备时，数据包会被发送到路由器。路由器检查数据包的目的IP地址，然后根据路由表决定如何将数据包转发到目标网络。

### 通信示例

- 假设有两个局域网，A和B。每个网络内部有多个设备，这些设备通过交换机相连。
- 当网络A上的一台电脑想要发送数据给网络B上的一台电脑时，数据首先会经过网络A的交换机，然后发送到连接这两个网络的路由器。
- 路由器根据数据包的目的IP地址，确定它需要被发送到网络B，并将数据包路由到那里。一旦到达网络B，交换机再将数据包分发给目标电脑。

## 路由器之间的连接

### 路由器之间的连接

1. **物理连接**：首先，需要通过以太网线或其他方式实现两台路由器之间的物理连接。
2. **配置路由**：在每台路由器上配置静态路由或使用动态路由协议，以便它们知道如何将数据包发送到对方的网络。

### 子网掩码和路由

- **子网掩码的作用**：子网掩码用于在路由器本地网络中区分网络地址和主机地址。它告诉路由器哪些IP地址属于它管理的本地网络。
- **通知对方路由器**：在设置路由器间的路由时，通常需要指定要达到的目标网络和子网掩码。这样，每台路由器就可以知道，当收到发往特定IP范围的数据包时，应该将其转发到连接的另一台路由器。

### 路由配置示例

- ### 基本步骤

  1. **登录到路由器的管理界面**：
     - 这通常通过在浏览器中输入路由器的IP地址来完成，比如 `192.168.1.1` 或 `192.168.0.1`。
  2. **查找静态路由配置选项**：
     - 在路由器管理界面中，找到静态路由或路由设置的部分。
  3. **配置静态路由**：
     - 输入**目标网络**的**IP地址**和**子网掩码**。例如，如果您正在路由器A上配置路由到路由器B，您将输入路由器B网络的IP地址范围和子网掩码。
     - 指定**下一跳**地址，即数据包应该被发送到哪个设备以到达目标网络。在这个例子中，这将是路由器B的IP地址。
  4. **保存设置并重启（如果需要）**：
     - 完成配置后，保存设置。某些路由器可能需要重启才能应用新的路由规则。

  ### 具体考虑因素

  - **了解网络布局**：明确每个路由器所连接的网络以及它们的IP地址范围。
  - **确保无IP冲突**：确保不同路由器管理的网络使用不同的IP地址范围，避免重叠。
  - **安全性考虑**：确保通过路由器间的路由不会引入安全隐患。

  

## 下一跳地址

  - **下一跳地址**：这是路由决策中用到的一个术语，指的是数据包在到达最终目的地之前，下一个要经过的设备（通常是路由器）的IP地址。
  - 在静态或动态路由配置中，"下一跳"是告诉网络包应该被发送到哪个具体的地址，以便正确地继续它的路径。

  ### 作用和应用

  1. **路由决策**：在一个网络中，当一个设备需要将数据包发送到不同子网或网络时，它会根据路由表中的下一跳地址来决定将数据包发送到哪个路由器。
  2. **网络流量的指向**：下一跳地址确保网络流量被正确地引导到目的地，特别是在包含多个路由器的复杂网络中。

  ### 实际例子

  - 假设您的电脑（在网络A）需要发送数据到网络B，但这两个网络是通过路由器C连接的。在这种情况下，电脑的数据包将被发送到路由器C（下一跳），然后路由器C会进一步处理这个包，将其转发到网络B。

  ### 配置中的重要性

  - 在设置静态路由时，通常需要指定下一跳地址，以便网络设备知道向哪里转发不属于本地子网的数据包。

  ### 示例

  假设您有两个网络：网络A（192.168.1.0/24，由路由器A管理）和网络B（192.168.2.0/24，由路由器B管理）。路由器A的IP地址是192.168.1.1，路由器B的IP地址是192.168.2.1。在路由器A上，您将配置一个静态路由，将目的地设置为192.168.2.0，子网掩码设置为255.255.255.0，下一跳地址设置为连接到路由器B的接口IP地址。

  ### 注意

  - 配置过程可能因路由器的型号和制造商而异，具体步骤可能有所不同。
  - 在进行任何网络配置更改之前，请确保您了解这些更改的影响，以避免中断网络服务。



总结来说，当不同局域网之间需要进行通信时，路由器是关键设备，负责不同网络之间的数据传输和路由。而交换机则局限于单个局域网内部的设备连接和数据转发。

![IP+MAC通信](http://sy0316.oss-cn-hangzhou.aliyuncs.com/img/image-20231227135624472.png)